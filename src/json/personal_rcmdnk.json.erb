{
  "title": "Personal rules (@rcmdnk)",
  "rules": [
    {
      "description": "For HHKB (Esc to `(~))",
      "manipulators": [
        {
          "type": "basic",
          "from": <%= from("escape", []) %>,
          "to": <%= to([["grave_accent_and_tilde", []]]) %>,
          "conditions": [ <%= device_if("hhkb") %>, <%= frontmost_application_if("emacs_key_bindings_exception") %> ]
        },
        {
          "type": "basic",
          "from": <%= from("escape", ["shift"]) %>,
          "to": <%= to([["grave_accent_and_tilde", ["shift"]]]) %>,
          "conditions": [ <%= device_if("hhkb") %>, <%= frontmost_application_if("emacs_key_bindings_exception") %> ]
        }
      ]
    },
    {
      <%# {% post_card /blog/2016/10/06/computer-mac-iterm/ MacのiTerm/ターミナルでメタキー(Alt)を使う方法 %} %>
      "description": "iTerm2 command (Meta) keys",
      "manipulators":
      <%=
        # Other than n, v, w
        iterm2Keys = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l",
                     "m", "o", "p", "q", "r", "s", "t", "u", "x", "y", "z"]
        each_key(
          source_keys_list: iterm2Keys,
          dest_keys_list: iterm2Keys,
          from_mandatory_modifiers: ["command"],
          to_modifiers: ["option"],
          conditions: [frontmost_application_if("iterm2", false)],
          as_json: true
        )
      %>
    },
    {
      "description": "ESC (or Control-[) sends ESC EISU ESC",
      "manipulators": [
        {
          "type": "basic",
          "from": <%= from("escape", []) %>,
          "to": <%= to([["escape"], ["japanese_eisuu"], ["escape"]]) %>,
          "conditions": [ <%= frontmost_application_if("emacs_key_bindings_exception") %> ]
        },
        {
          "type": "basic",
          "from": <%= from("open_bracket", ["control"]) %>,
          "to": <%= to([["escape"], ["japanese_eisuu"], ["escape"]]) %>,
          "conditions": [ <%= frontmost_application_if("emacs_key_bindings_exception") %> ]
        }
      ]
    },
    {
      "description": "Copy and Paste, ctrl-z/x/c/v to cmd-z/x/c/v",
      "manipulators":
      <%=
        manipulators = each_key(
          source_keys_list: ["z", "x", "c", "v"],
          dest_keys_list: ["z", "x", "c", "v"],
          from_mandatory_modifiers: ["control"],
          to_modifiers: ["command"],
          conditions: [frontmost_application_unless("emacs_key_bindings_exception", false)]
        )
        manipulators += each_key(
          source_keys_list: ["z", "x", "c", "v"],
          dest_keys_list: ["z", "x", "c", "v"],
          from_mandatory_modifiers: ["shift", "control"],
          to_modifiers: ["shift", "command"],
          conditions: [frontmost_application_unless("emacs_key_bindings_exception", false)]
        )
        JSON.generate(manipulators)
      %>
    },
    {
      "description": "Next/Prev by ctrl-i/o, option-left/right arrow",
      "manipulators":
      <%=
        manipulators = each_key(
          source_keys_list: ["i", "o"],
          dest_keys_list: ["close_bracket", "open_bracket"],
          from_mandatory_modifiers: ["control"],
          to_modifiers: ["command"],
          conditions: [frontmost_application_unless("emacs_key_bindings_exception", false)]
        )
        manipulators += each_key(
          source_keys_list: ["right_arrow", "left_arrow"],
          dest_keys_list: ["close_bracket", "open_bracket"],
          from_mandatory_modifiers: ["option"],
          to_modifiers: ["command"],
          conditions: [frontmost_application_unless("emacs_key_bindings_exception", false)]
        )
        JSON.generate(manipulators)
      %>
    },
    {
      "description": "Browsers (cmd-(shift-)tab to cmd-opt-right(left))",
      "manipulators": [
        {
          "type": "basic",
          "from": <%= from("tab", ["command"]) %>,
          "to": <%= to([["right_arrow", ["command", "option"]]]) %>,
          "conditions": [ <%= frontmost_application_if("browser") %> ]
        },
        {
          "type": "basic",
          "from": <%= from("tab", ["command", "shift"]) %>,
          "to": <%= to([["left_arrow", ["command", "option"]]]) %>,
          "conditions": [ <%= frontmost_application_if("browser") %> ]
        }
      ]
    },
    {
      "description": "Microsoft Office (ctrl-h, font, superscript/subscript)",
      "manipulators": [
        <%# ctrl-h %>
        {
          "type": "basic",
          "from": <%= from("h", ["control"]) %>,
          "to": <%= to([["delete_or_backspace"]]) %>,
          "conditions": [ <%= frontmost_application_if("office") %> ]
        },
        <%# font Symbol %>
        {
          "type": "basic",
          "from": <%= from("s", ["control", "command", "shift"]) %>,
          "to": <%= to([["t", ["command"]], ["tab"], ["s"], ["y"], ["m"], ["b"], ["o"], ["l"], ["return_or_enter"]]) %>,
          "conditions": [ <%= frontmost_application_if("office") %> ]
        },
        <%# font Helvetica %>
        {
          "type": "basic",
          "from": <%= from("h", ["control", "command", "shift"]) %>,
          "to": <%= to([["t", ["command"]], ["tab"], ["h"], ["e"], ["l"], ["v"], ["e"], ["t"], ["i"], ["c"], ["a"], ["return_or_enter"]]) %>,
          "conditions": [ <%= frontmost_application_if("office") %> ]
        },
        <%# Superscript %>
        {
          "type": "basic",
          "from": <%= from("equal_sign", ["control"]) %>,
          "to": <%= to([["t", ["command"]],
                        ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"],
                        ["spacebar"], ["return_or_enter"]]) %>,
          "conditions": [ <%= frontmost_application_if("office") %> ]
        },
        <%# Subscript %>
        {
          "type": "basic",
          "from": <%= from("hyphen", ["control"]) %>,
          "to": <%= to([["t", ["command"]],
                        ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"], ["tab"],
                        ["spacebar"], ["return_or_enter"]]) %>,
          "conditions": [ <%= frontmost_application_if("office") %> ]
        }
      ]
    },
    {
      "description": "Change cmd-ctrl-h/j/k/l to arrow keys",
      "manipulators":
      <%=
        each_key(
          source_keys_list: ["h", "j", "k", "l"],
          dest_keys_list: ["left_arrow", "down_arrow", "up_arrow", "right_arrow"],
          from_mandatory_modifiers: ["control", "command"],
          as_json: true
        )
      %>
    },
    {
      "description": "Window Actions",
      "manipulators": [
        <%=
          askeys = [
            ["4", ["command"], "close"],
            ["4", ["control"], "close"],
            ["a", ["control", "command"], "closeToDock"],
            ["spacebar", ["option"], "focusMenu"],
            ["period", ["option"], "moveForMon"],
            ["slash", ["command", "shift"], "moveForMonAll"],
            ["y", ["control", "shift"], "windowMoveLeft"],
            ["u", ["control", "shift"], "windowMoveDown"],
            ["i", ["control", "shift"], "windowMoveUp"],
            ["o", ["control", "shift"], "windowMoveRight"],
            ["y", ["command", "control", "shift"], "winMoveScreenLeft"],
            ["u", ["command", "control", "shift"], "winMoveScreenDown"],
            ["i", ["command", "control", "shift"], "winMoveScreenUp"],
            ["o", ["command", "control", "shift"], "winMoveScreenRight"],
            ["return_or_enter", ["command", "control"], "wsFull"],
            ["return_or_enter", ["command", "shift"], "wsFull"],
            ["return_or_enter", ["command", "control", "shift"], "wsHalf"],
            ["h", ["command", "shift"], "wsHalfLeft"],
            ["j", ["command", "shift"], "wsHalfBottom"],
            ["k", ["command", "shift"], "wsHalfTop"],
            ["l", ["command", "shift"], "wsHalfRight"],
            ["y", ["command", "shift"], "windowResizeWidthMinus"],
            ["u", ["command", "shift"], "windowResizeHeightPlus"],
            ["i", ["command", "shift"], "windowResizeHeightMinus"],
            ["o", ["command", "shift"], "windowResizeWidthPlus"]
          ]
          manipulators = ""
          for key in askeys do
            manipulators += "{
              \"type\": \"basic\",
              \"from\": #{from(key[0], key[1])},
              \"to\": [{\"shell_command\": \"osascript ~/Library/Scripts/#{key[2]}.scpt\"}]
            },"
          end
          manipulators.chop!
          manipulators
        %>
      ]
    },
    {
      <%# -------------------------------------------------- %>
      <%# Need to enable Mouse Key from System Preferences (Accessibility->Mouse and Trackpad) %>
      <%# -------------------------------------------------- %>
      "description": "Mouse cursor move",
      "manipulators": [
        <%=
          mousekeys = [
            ["h", ["control", "shift"], "mouseMoveLeft"],
            ["j", ["control", "shift"], "mouseMoveDown"],
            ["k", ["control", "shift"], "mouseMoveUp"],
            ["l", ["control", "shift"], "mouseMoveRight"]
          ]
          manipulators = ""
          for key in mousekeys do
            manipulators += "{
              \"type\": \"basic\",
              \"from\": #{from(key[0], key[1])},
              \"to\": [{\"shell_command\": \"osascript ~/Library/Scripts/#{key[2]}.scpt\"}]
            },"
          end
          manipulators
        %>
        {
          "type": "basic",
          "from": <%= from("n", ["control", "shift"]) %>,
          "to": <%= to_button([["button1"]]) %>
        },
        {
          "type": "basic",
          "from": <%= from("m", ["control", "shift"]) %>,
          "to": <%= to_button([["button3"]]) %>
        },
        {
          "type": "basic",
          "from": <%= from("p", ["control", "shift"]) %>,
          "to": <%= to_button([["button2"]]) %>
        }
      ]
    },
    {
      "description": "Control-[ to ESC",
      "manipulators": [
        {
          "type": "basic",
          "from": <%= from("open_bracket", ["control"]) %>,
          "to": <%= to([["escape"]]) %>
        }
      ]
    },
    {
      "description": "Others (Dock, Sleep, Delete, IME, Misison Control, Spotlight)",
      "manipulators": [
        <%# Focus on Dock %>
        {
          "type": "basic",
          "from": <%= from("m", ["control"]) %>,
          "to": <%= to([["f3", ["control"]]]) %>
        },
        <%# Sleep %>
        {
          "type": "basic",
          "from": <%= from("l", ["option"]) %>,
          "to": <%= to([["eject", ["control", "shift"]]]) %>
        },
        <%# Delete %>
        {
          "type": "basic",
          "from": <%= from("d", ["command"]) %>,
          "to": <%= to([["delete_or_backspace", ["command"]]]) %>
        },
        {
          "type": "basic",
          "from": <%= from("delete_or_backspace", ["control"]) %>,
          "to": <%= to([["delete_or_backspace", ["command"]]]) %>
        },
        <%# IME %>
        {
          "type": "basic",
          "from": <%= from("spacebar", ["control"]) %>,
          "to": <%= to([["spacebar", ["option", "control"]]]) %>
        },
        {
          "type": "basic",
          "from": <%= from("spacebar", ["command"]) %>,
          "to": <%= to([["spacebar", ["option", "control"]]]) %>
        },
        <%# Mission Control %>
        {
          "type": "basic",
          "from": <%= from("h", ["command", "control", "shift"]) %>,
          "to": <%= to([["left_arrow", ["control"]]]) %>
        },
        {
          "type": "basic",
          "from": <%= from("l", ["command", "control", "shift"]) %>,
          "to": <%= to([["right_arrow", ["control"]]]) %>
        },
        <%# Spotlight %>
        {
          "type": "basic",
          "from": <%= from("f", ["command", "control"]) %>,
          "to": <%= to([["spacebar", ["command"]]]) %>
        }
      ]
    }
  ]
}
